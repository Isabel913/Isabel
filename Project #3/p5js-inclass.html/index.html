<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Expression with P5js</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.2.0/p5.js"></script>

    <style>
        html,
        body {
            height: 100%;
        }

        body {
            margin: 0px;
            display: flex;
            justify-content: center;
            align-items: center;

        }
    </style>
</head>

<body>
    <script>
        let baseURL = "https://api.particle.io/v1/devices/2b002f001847393035313137/";
        let token = "?access_token=2492c9457776d80908762c6ae9598f3a9b7fa105";
        let param1 = "motion";
        //let param2 = "pot2";
        //let param3 = "sensor";
        let data1URL = baseURL + param1 + token; //for potentiometer 1
        //let data2URL = baseURL + param2 + token; //for potentiometer 2
        //let data3URL = baseURL + param3 + token; //for iR Sensor

        //TIMERvars
        let currentFactor, prevFactor;
        let timeInterval = 1000;
        let whichParam = 1;
        let numberOfParams = 1;

        //COLORvars:
        let myHue = 0;
        let mySat = 100;

        //XandY
        let x = 100;
        let y = 100;

        //X Speed
        let xspeed = 0.3;

        //RABBIT  
        let myRabbit;


        function setup() {
            createCanvas(600, 600);

            angleMode(DEGREES);
            currentFactor = 0;
            prevFactor = 0;
            myRabbit = new Rabbit(300, 300);
        }

        function draw() {
            background(196, 238, 252);

            myRabbit.display();
            myRabbit.move();

            currentFactor = millis() % timeInterval;
            if (currentFactor < prevFactor) {
                loadJSON(data1URL, dataHandle, errorHandle);
            }

            prevFactor = currentFactor;

        }


        function dataHandle(JSONdata) {
            console.log(JSONdata);
            if (JSONdata.name === "motion" && JSONdata.result === 1) { // if this is true
                console.log("Hello");
                myRabbit.visible = true;
                //myRabbit.run = true;

            } else {
                myRabbit.visible = false;
                //myRabbit.run = false;
            }

        }

        function errorHandle(ErrorData) {
            console.log("Error has occured: " + ErrorData);
        }


        class Rabbit {
            constructor(_x, _y) {
                this.x = _x;
                this.y = _y;

                this.visible = false;
                //this.run = false;
            }

            display() {
                if (this.visible) {
                    fill(252, 215, 196);
                    push()
                    translate(this.x, this.y);
                    rotate(30)
                    rect(-45, -29, 50, 30, 20);
                    rotate(160);
                    ellipse(38, 63, 9.5, 30); //ear
                    pop()
                    fill(252, 215, 196);
                    arc(this.x, this.y, 20, 15, 180, 0, PIE);
                    fill(307, 30, 100);
                    ellipse(this.x - 46, this.y - 40, 5, 5);
                    fill(252, 215, 196);
                    ellipse(this.x - 35, this.y - 45, 25, 25);
                    rect(this.x - 34, this.y - 28, 10, 30, 20);

                }
            }

            move() {
                this.x = this.x - 0.3;
                if (this.x < 0) {
                    this.x = this.x + 0.3;
                    //xspeed=-xspeed;
                }
            }


        }
    </script>

</body>

</html>